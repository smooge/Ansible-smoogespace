// {{ ansible_managed }}
//
// WARNING
//
// Do NOT edit this file while ZNC is running!
// Use webadmin or *controlpanel instead.
//
// Altering this file by hand will forfeit all support.
//
// But if you feel risky, you might want to read help on /znc saveconfig and /znc rehash.
// Also check https://wiki.znc.in/Configuration

AnonIPLimit = 10
AuthOnlyViaModule = false
ConfigWriteDelay = 0
ConnectDelay = 5
HideVersion = false
{% for system_module in znc_system_modules %}
LoadModule = {{ system_module }}
{% endfor %}
MaxBufferSize = {{ znc_max_buffer }}
ProtectWebSessions = true
SSLCertFile = {{ znc_ssl_pem }}
SSLDHParamFile = {{ znc_ssl_pem }}
SSLKeyFile = {{ znc_ssl_pem }}
ServerThrottle = 30
Skin = _default_
StatusPrefix = *
Version = {{ znc_version }}

<Listener listener0>
        AllowIRC = true
        AllowWeb = true
        IPv4 = {{ (znc_ipv4 | bool) | lower }}
        IPv6 = {{ (znc_ipv6 | bool) | lower }}
        Port = {{ znc_port }}
        SSL = {{ (znc_ssl | bool) | lower }}
        URIPrefix = /  
</Listener>

{% for user in znc_users %}
<User {{ user.name }}>
        Admin = {{ user.admin | default(false) | bool | lower }}
        Allow = {{ user.allow | default("*") }}
        AltNick = {{ user.altnick | default(user.nick+"_") }}
        AppendTimestamp = {{ user.atimestamp | default(false) | bool | lower }}
        AuthOnlyViaModule = false
        AutoClearChanBuffer = {{ user.autoclearchanbuffer | default(true) | bool | lower }}
        AutoClearQueryBuffer = true
        ChanBufferSize = {{ user.buffer | default(znc_max_buffer_size) }}
        ChanModes = {{ user.chanmodes | default("+stn") }}
        DenyLoadMod = false
        DenySetBindHost = false
        Ident = {{ user.ident | default(user.nick) }}
        JoinTries = 10
{% if user.modules is defined %}
{% for module in user.modules %}
        LoadModule = {{ module }}
{% endfor %}
{% endif %}
        MaxJoins = 0
        MaxNetworks = 1
        MaxQueryBuffers = 50
        MultiClients = {{ user.multiclients | default(false) | bool | lower }}
        Nick = {{ user.nick }}
        NoTrafficTimeout = 180 
        PrependTimestamp = {{ user.atimestamp | default(false) | bool | lower}}
        QueryBufferSize = 50
        QuitMsg = {{ user.quitmsg | default("crashed.") }}
        RealName = {{ user.realname | default(user.nick) }}
        TimestampFormat = {{ user.timestamp }}
        Timezone = {{ user.timezone }}

{% if user.networks is defined %}
{% for network_name, network in user.networks.items() %}

        <Network {{ network_name }}>
                FloodBurst = 4
                FloodRate = 1.00
                IRCConnectEnabled = true
{% if network.modules is defined %}
{% for module in network.modules %}
                LoadModule = {{ module }}
{% endfor %}
{% endif %}
                Server = {{ network.server }} {{ "+" if network.ssl else "" }}{{ network.port }} {{ network.password | default("") }}
                TrustAllCerts = false
                TrustPKI = true

{% if network.channels is defined %}
{% for channel in network.channels %}
                <Chan {{ channel }}>
                </Chan>
		
{% endfor %}
{% endif %}
  </Network>
{% endfor %}
{% endif %}

    <Pass password>
        Hash   = {{ user.password.hash }}
        Method = {{ user.password.method }}
        Salt   = {{ user.password.salt }}
    </Pass>

</User>

{% endfor %}
